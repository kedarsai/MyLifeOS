{
  "type": "object",
  "additionalProperties": false,
  "required": [
    "goal_id",
    "period",
    "deterministic_metrics",
    "missing_data",
    "what_went_well",
    "what_did_not_go_well",
    "patterns",
    "next_best_actions",
    "risk_level",
    "confidence"
  ],
  "properties": {
    "goal_id": { "type": "string" },
    "period": {
      "type": "object",
      "additionalProperties": false,
      "required": ["start_date", "end_date", "timezone"],
      "properties": {
        "start_date": { "type": "string" },
        "end_date": { "type": "string" },
        "timezone": { "type": "string" }
      }
    },
    "deterministic_metrics": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "steps_avg_7d",
        "steps_streak_days",
        "sleep_avg_min_7d",
        "weight_latest_kg",
        "weight_trend_7d_kg_per_week",
        "weight_trend_30d_kg_per_week",
        "activity_sleep_corr",
        "sleep_weight_corr",
        "logging_completeness_pct"
      ],
      "properties": {
        "steps_avg_7d": { "type": ["number", "null"] },
        "steps_streak_days": { "type": ["integer", "null"] },
        "sleep_avg_min_7d": { "type": ["number", "null"] },
        "weight_latest_kg": { "type": ["number", "null"] },
        "weight_trend_7d_kg_per_week": { "type": ["number", "null"] },
        "weight_trend_30d_kg_per_week": { "type": ["number", "null"] },
        "activity_sleep_corr": { "type": ["number", "null"] },
        "sleep_weight_corr": { "type": ["number", "null"] },
        "logging_completeness_pct": { "type": "number" }
      }
    },
    "missing_data": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["metric", "date"],
        "properties": {
          "metric": { "type": "string", "enum": ["sleep", "food", "activity", "weight", "other"] },
          "date": { "type": "string" }
        }
      }
    },
    "what_went_well": {
      "type": "array",
      "items": { "type": "string" }
    },
    "what_did_not_go_well": {
      "type": "array",
      "items": { "type": "string" }
    },
    "patterns": {
      "type": "array",
      "items": { "type": "string" }
    },
    "next_best_actions": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["title", "due_date", "priority", "rationale"],
        "properties": {
          "title": { "type": "string" },
          "due_date": { "type": ["string", "null"] },
          "priority": { "type": "string", "enum": ["low", "medium", "high"] },
          "rationale": { "type": ["string", "null"] }
        }
      }
    },
    "risk_level": { "type": "string", "enum": ["low", "medium", "high"] },
    "confidence": { "type": "number" }
  }
}
